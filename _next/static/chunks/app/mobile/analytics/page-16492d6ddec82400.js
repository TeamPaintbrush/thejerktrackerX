(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5654,5857],{15426:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(95155),r=s(12115),i=s(65523),o=s(94437),n=s(97971);function l(){let[e,t]=(0,r.useState)(null);return((0,r.useEffect)(()=>{t(n.F.getCurrentUser())},[]),null==e?void 0:e.id)?(0,a.jsx)(i.default,{children:(0,a.jsx)(o.A,{businessId:e.id})}):(0,a.jsx)(i.default,{children:(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:(0,a.jsx)("p",{children:"Please sign in to view analytics"})})})}},19825:()=>{},24137:(e,t,s)=>{Promise.resolve().then(s.bind(s,15426))},26989:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("settings-2",[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]])},52583:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("scan-line",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M7 12h10",key:"b7w52i"}]])},65993:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]])},80111:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("scan-barcode",[["path",{d:"M3 7V5a2 2 0 0 1 2-2h2",key:"aa7l1z"}],["path",{d:"M17 3h2a2 2 0 0 1 2 2v2",key:"4qcy5o"}],["path",{d:"M21 17v2a2 2 0 0 1-2 2h-2",key:"6vwrx8"}],["path",{d:"M7 21H5a2 2 0 0 1-2-2v-2",key:"ioqczr"}],["path",{d:"M8 7v10",key:"23sfjj"}],["path",{d:"M12 7v10",key:"jspqdw"}],["path",{d:"M17 7v10",key:"578dap"}]])},81494:(e,t,s)=>{"use strict";s.d(t,{h:()=>a});let a=(0,s(32587).F3)("PushNotifications",{})},87066:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(71847).A)("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]])},97971:(e,t,s)=>{"use strict";s.d(t,{F:()=>o});var a=s(39903),r=s(47620);class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}async signIn(e,t){console.log("\uD83D\uDD10 MobileAuth.signIn called with:",e);let s={API_BASE_URL:"https://rqbyr7htb1.execute-api.us-east-1.amazonaws.com/prod",API_KEY:"w15QRuSday4YHbK0FH3zc77mzY3nikKX6qEY2xZS",LOCATION_ADMIN_KEY:"pSq4vhYdRnB7OUCkfQlo9M3z6rJEaD2F"};if(!s.API_BASE_URL){console.log("\uD83D\uDCC4 Loading config from public file...");try{let e=await fetch("/config.json");e.ok&&(s=await e.json(),console.log("✅ Config loaded from file:",s))}catch(e){console.log("❌ Failed to load config file:",e)}}console.log("\uD83D\uDD0D Environment check:",s),this.setLoading(!0),this.setError(null);try{let i=(s.API_BASE_URL||"").trim().replace(/\/$/,"");if(console.log("\uD83D\uDCE1 API_BASE_URL resolved to:",i),i){let a="".concat(i,"/auth/login");console.log("\uD83D\uDE80 Login URL:",a);let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":s.API_KEY||""},body:JSON.stringify({email:e,password:t})});console.log("\uD83D\uDCE1 Response status:",r.status,r.statusText);let o=await r.json();if(console.log("\uD83D\uDCC4 Response data:",o),r.ok&&o.success)return await this.setAuthenticated(o.user),{success:!0};return this.setError(o.error||"Invalid email or password"),{success:!1,error:o.error||"Invalid email or password"}}{console.log("\uD83D\uDCE1 Using direct DynamoDB authentication (Lambda API not configured)");let s=await a.DynamoDBService.getUserByEmail(e);if(!s||!s.password)return this.setError("User not found"),{success:!1,error:"User not found"};if(!await r.Ay.compare(t,s.password))return this.setError("Invalid email or password"),{success:!1,error:"Invalid email or password"};{let e={id:s.id,email:s.email,name:s.name,role:s.role,businessId:s.businessId};return await this.setAuthenticated(e),{success:!0}}}}catch(t){let e=t instanceof Error?t.message:"Authentication failed";return console.log("❌ MobileAuth.signIn error:",e),this.setError(e),{success:!1,error:e}}finally{this.setLoading(!1)}}getTestAccount(e,t){let s=[{id:"test_admin",email:"admin@jerktrackerx.com",password:"admin123",name:"Admin User",role:"admin"},{id:"test_manager",email:"manager@jerktrackerx.com",password:"manager123",name:"Manager User",role:"manager"},{id:"test_driver",email:"driver@jerktrackerx.com",password:"driver123",name:"Driver User",role:"driver"},{id:"test_customer",email:"customer@jerktrackerx.com",password:"customer123",name:"Customer User",role:"customer"}].find(s=>s.email===e&&s.password===t);return s?{id:s.id,email:s.email,name:s.name,role:s.role,businessId:"test_business",phone:"+1234567890",createdAt:new Date,updatedAt:new Date}:null}async signUp(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"customer";console.log("\uD83D\uDCDD MobileAuth.signUp called with:",e,s,i);let o={API_BASE_URL:"https://rqbyr7htb1.execute-api.us-east-1.amazonaws.com/prod",API_KEY:"w15QRuSday4YHbK0FH3zc77mzY3nikKX6qEY2xZS"};if(!o.API_BASE_URL){console.log("\uD83D\uDCC4 Loading config from public file...");try{let e=await fetch("/config.json");e.ok&&(o=await e.json(),console.log("✅ Config loaded from file:",o))}catch(e){console.log("❌ Failed to load config file:",e)}}this.setLoading(!0),this.setError(null);try{let n=(o.API_BASE_URL||"").trim().replace(/\/$/,"");if(n){let a="".concat(n,"/auth/signup");console.log("\uD83D\uDE80 Signup URL:",a);let r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":o.API_KEY||""},body:JSON.stringify({email:e,password:t,name:s,role:i})});console.log("\uD83D\uDCE1 Response status:",r.status,r.statusText);let l=await r.json();if(console.log("\uD83D\uDCC4 Response data:",l),r.ok&&l.success)return await this.setAuthenticated(l.user),{success:!0};return this.setError(l.error||"Sign up failed"),{success:!1,error:l.error||"Sign up failed"}}{console.log("\uD83D\uDCE1 Using direct DynamoDB signup (Lambda API not configured)");let o=await r.Ay.hash(t,12),n=await a.DynamoDBService.createUser({email:e,password:o,name:s,role:i}),l={id:n.id,email:n.email,name:n.name,role:n.role,businessId:n.businessId};return await this.setAuthenticated(l),{success:!0}}}catch(t){console.error("❌ Signup error:",t);let e=t instanceof Error?t.message:"Sign up failed";return this.setError(e),{success:!1,error:e}}finally{this.setLoading(!1)}}async signOut(){this.authState={isAuthenticated:!1,user:null,loading:!1,error:null},localStorage.removeItem("mobile_auth_user"),localStorage.removeItem("mobile_auth_token"),this.notifyListeners()}getAuthState(){return{...this.authState}}isAuthenticated(){return this.authState.isAuthenticated}getCurrentUser(){return this.authState.user}subscribe(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}loadAuthState(){try{let e=localStorage.getItem("mobile_auth_user"),t=localStorage.getItem("mobile_auth_token");if(e&&t){let t=JSON.parse(e);this.authState={isAuthenticated:!0,user:t,loading:!1,error:null},this.syncUserData(t.email)}}catch(e){console.error("Failed to load auth state:",e)}}async syncUserData(e){try{let t="https://rqbyr7htb1.execute-api.us-east-1.amazonaws.com/prod".trim().replace(/\/$/,"");if(!t)return void console.warn("Lambda API not configured, skipping sync");let s=await fetch("".concat(t,"/auth/verify"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e})});if(s.ok){let e=await s.json();if(e.success&&e.user){let t=e.user;localStorage.setItem("mobile_auth_user",JSON.stringify(t)),this.authState={...this.authState,user:t},this.notifyListeners(),console.log("✅ User data synced from DynamoDB")}}}catch(e){console.warn("Failed to sync user data:",e)}}async setAuthenticated(e){let t="mock_token_"+Date.now();this.authState={isAuthenticated:!0,user:e,loading:!1,error:null},localStorage.setItem("mobile_auth_user",JSON.stringify(e)),localStorage.setItem("mobile_auth_token",t),this.notifyListeners()}async refreshUserData(){let e=this.getCurrentUser();(null==e?void 0:e.email)&&await this.syncUserData(e.email)}setLoading(e){this.authState={...this.authState,loading:e},this.notifyListeners()}setError(e){this.authState={...this.authState,error:e},this.notifyListeners()}notifyListeners(){this.listeners.forEach(e=>e({...this.authState}))}getDefaultRoute(e){switch(e){case"admin":case"customer":return"/mobile/dashboard";case"manager":case"driver":return"/mobile/orders";default:return"/mobile"}}constructor(){this.authState={isAuthenticated:!1,user:null,loading:!1,error:null},this.listeners=[],this.loadAuthState()}}let o=i.getInstance()}},e=>{e.O(0,[2207,1733,7646,2619,4968,2987,9903,5523,4437,8441,1255,7358],()=>e(e.s=24137)),_N_E=e.O()}]);