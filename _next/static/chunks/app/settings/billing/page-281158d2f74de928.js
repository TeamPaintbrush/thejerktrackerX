(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9754],{14587:(e,t,i)=>{Promise.resolve().then(i.bind(i,28297))},20063:(e,t,i)=>{"use strict";var n=i(47260);i.o(n,"usePathname")&&i.d(t,{usePathname:function(){return n.usePathname}}),i.o(n,"useRouter")&&i.d(t,{useRouter:function(){return n.useRouter}}),i.o(n,"useSearchParams")&&i.d(t,{useSearchParams:function(){return n.useSearchParams}}),i.o(n,"useServerInsertedHTML")&&i.d(t,{useServerInsertedHTML:function(){return n.useServerInsertedHTML}})},28297:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>k});var n=i(95155),r=i(12115),o=i(47921),a=i(20063),s=i(50625);class l{static calculateBillingAmount(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.BILLING_PLANS[e];if(!n)throw Error("Invalid billing plan: ".concat(e));let r=i?n.yearlyPrice:n.monthlyPrice,o=n.limits.locations;if(-1===o)return{basePrice:r,locationOveragePrice:0,totalAmount:r,isOverage:!1};let a=Math.max(0,t-o),s=a*(i?239.88:24.99);return{basePrice:r,locationOveragePrice:s,totalAmount:r+s,isOverage:a>0}}static async generateUsageReport(e,t,n){try{let{DynamoDBService:r}=await Promise.all([i.e(7646),i.e(9903)]).then(i.bind(i,39903)),o=(await r.getLocationsByBusinessId(e)).map(e=>({locationId:e.id,locationName:e.name,ordersCount:e.billing.monthlyUsage,isActive:e.billing.isActive,activatedAt:e.billing.activatedAt,deactivatedAt:e.billing.deactivatedAt})),a=o.filter(e=>e.isActive).length,s=o.reduce((e,t)=>e+t.ordersCount,0),l={planId:"professional",isActive:!0,nextBillingDate:new Date(Date.now()+2592e6)},c=this.calculateBillingAmount(l.planId,a);return{businessId:e,billingPeriod:{start:t,end:n},locations:o,totals:{activeLocations:a,totalOrders:s,baseCharge:c.basePrice,locationCharges:c.locationOveragePrice,totalAmount:c.totalAmount},subscription:l}}catch(e){throw console.error("Error generating usage report:",e),e}}static async createInvoice(e,t){try{let i="INV-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9).toUpperCase()),n=[],r=this.BILLING_PLANS[t.subscription.planId];if(n.push({description:"".concat(r.name," - ").concat(this.formatDateRange(t.billingPeriod)),quantity:1,unitPrice:t.totals.baseCharge,amount:t.totals.baseCharge}),t.totals.locationCharges>0){let e=t.totals.activeLocations-r.limits.locations;n.push({description:"Additional Locations (".concat(e," locations)"),quantity:e,unitPrice:24.99,amount:t.totals.locationCharges})}let o=n.reduce((e,t)=>e+t.amount,0),a=.08*o;return{id:"invoice_".concat(Date.now()),businessId:e,invoiceNumber:i,billingPeriod:t.billingPeriod,lineItems:n,subtotal:o,tax:a,total:o+a,status:"draft",issuedAt:new Date,dueDate:new Date(Date.now()+1296e6)}}catch(e){throw console.error("Error creating invoice:",e),e}}static async checkPlanLimits(e,t){try{let{DynamoDBService:n}=await Promise.all([i.e(7646),i.e(9903)]).then(i.bind(i,39903)),r=(await n.getLocationsByBusinessId(e)).filter(e=>e.billing.isActive).length,o=this.BILLING_PLANS[t];if(!o)throw Error("Invalid plan: ".concat(t));let a=o.limits.locations,s=-1!==a&&r>a,l="";return s&&(l="basic"===t&&r<=10?"Consider upgrading to Professional Plan":"professional"===t&&r>10?"Consider upgrading to Enterprise Plan":"Additional location charges will apply"),{isOverLimit:s,currentLocations:r,planLimit:-1===a?1/0:a,overageCount:s?r-a:0,recommendedAction:l}}catch(e){throw console.error("Error checking plan limits:",e),e}}static getAvailablePlans(){return Object.values(this.BILLING_PLANS)}static getPlanById(e){return this.BILLING_PLANS[e]||null}static calculateProration(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,r=e/n*i,o=t/n*i;return{proratedCredit:r,proratedCharge:o,netAmount:o-r}}static async validateLocationActivation(e,t){try{let i=await this.checkPlanLimits(e,t);if(!i.isOverLimit)return{canActivate:!0};return{canActivate:!0,reason:"This will exceed your plan limit of ".concat(i.planLimit," locations"),suggestedAction:"Additional charges of $24.99/month per location will apply, or ".concat(i.recommendedAction)}}catch(e){return console.error("Error validating location activation:",e),{canActivate:!1,reason:"Unable to validate plan limits"}}}static formatDateRange(e){let t={year:"numeric",month:"short",day:"numeric"},i=e.start.toLocaleDateString("en-US",t),n=e.end.toLocaleDateString("en-US",t);return"".concat(i," - ").concat(n)}static async getUsageSummary(e){try{let{DynamoDBService:t}=await Promise.all([i.e(7646),i.e(9903)]).then(i.bind(i,39903)),n=await t.getLocationsByBusinessId(e),r=n.filter(e=>e.billing.isActive),o=n.reduce((e,t)=>e+t.billing.monthlyUsage,0),a="professional",s=this.BILLING_PLANS[a],l=this.calculateBillingAmount(a,r.length),c=await this.checkPlanLimits(e,a);return{currentPlan:s.name,locationsUsed:r.length,locationsLimit:-1===s.limits.locations?1/0:s.limits.locations,currentMonthOrders:o,estimatedMonthlyBill:l.totalAmount,nextBillingDate:new Date(Date.now()+1296e6),overageWarning:c.isOverLimit?c.recommendedAction:void 0}}catch(e){throw console.error("Error getting usage summary:",e),e}}}l.BILLING_PLANS={basic:{id:"basic",name:"Basic Plan",description:"Perfect for single-location restaurants",monthlyPrice:29.99,yearlyPrice:299.99,features:["Up to 3 locations","Unlimited orders per location","Basic analytics","Email support","QR code ordering"],limits:{locations:3,support:"email",analytics:!0,customBranding:!1}},professional:{id:"professional",name:"Professional Plan",description:"Great for growing restaurant chains",monthlyPrice:79.99,yearlyPrice:799.99,features:["Up to 10 locations","Unlimited orders per location","Advanced analytics & reports","Priority email support","Custom branding","Driver management"],limits:{locations:10,support:"priority",analytics:!0,customBranding:!0}},enterprise:{id:"enterprise",name:"Enterprise Plan",description:"For large restaurant chains and franchises",monthlyPrice:199.99,yearlyPrice:1999.99,features:["Unlimited locations","Unlimited orders per location","Full analytics suite & business intelligence","Phone & priority support","Custom branding & white-label","Advanced driver management","API access"],limits:{locations:-1,support:"phone",analytics:!0,customBranding:!0}}};var c=i(40294),d=i(66585);let p=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-0"})(["min-height:100vh;background:linear-gradient(135deg,#ed7734 0%,#de5d20 100%);padding:20px;@media (max-width:768px){padding:10px;}"]),h=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-1"})(["max-width:1200px;margin:0 auto;background:white;border-radius:12px;padding:30px;box-shadow:0 8px 32px rgba(0,0,0,0.1);@media (max-width:768px){padding:20px;}"]),u=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-2"})(["margin-bottom:30px;h1{margin:0 0 10px 0;color:#333;font-size:28px;}p{margin:0;color:#666;font-size:16px;}"]),g=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-3"})(["display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:30px;"]),m=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-4"})(["background:white;border:1px solid #e1e5e9;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.05);"]),x=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-5"})(["margin-bottom:15px;h3{margin:0 0 5px 0;color:#333;font-size:18px;}p{margin:0;color:#666;font-size:14px;}"]),f=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-6"})(["margin:15px 0;"]),b=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-7"})(["width:100%;height:8px;background:#f3f4f6;border-radius:4px;overflow:hidden;&::after{content:'';display:block;width:","%;height:100%;background:",";transition:width 0.3s ease;}"],e=>Math.min(e.$percentage,100),e=>e.$isOverage?"#ef4444":e.$percentage>80?"#f59e0b":"#10b981"),y=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-8"})(["display:flex;justify-content:between;align-items:center;margin-top:8px;font-size:14px;color:#666;"]),v=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-9"})(["font-size:32px;font-weight:700;color:#ed7734;margin-bottom:5px;"]),j=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-10"})(["font-size:14px;color:#666;text-transform:uppercase;font-weight:600;"]),w=(0,s.Ay)(m).withConfig({componentId:"jt-app__sc-518baf73-11"})(["border:",";position:relative;cursor:",";transition:all 0.3s ease;&:hover{transform:",";box-shadow:",";}"],e=>e.$isSelected?"2px solid #ed7734":"1px solid #e1e5e9",e=>e.$isSelected?"default":"pointer",e=>e.$isSelected?"none":"translateY(-2px)",e=>e.$isSelected?"0 2px 8px rgba(0, 0, 0, 0.05)":"0 4px 16px rgba(0, 0, 0, 0.1)"),A=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-12"})(["position:absolute;top:-10px;right:20px;background:#ed7734;color:white;padding:4px 12px;border-radius:20px;font-size:12px;font-weight:600;text-transform:uppercase;"]),P=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-13"})(["font-size:36px;font-weight:700;color:#333;margin:15px 0;.period{font-size:16px;color:#666;font-weight:400;}.yearly-savings{font-size:14px;color:#10b981;font-weight:600;display:block;margin-top:5px;}"]),_=s.Ay.ul.withConfig({componentId:"jt-app__sc-518baf73-14"})(["list-style:none;padding:0;margin:15px 0;li{padding:8px 0;color:#333;font-size:14px;&::before{content:'âœ“';color:#10b981;font-weight:600;margin-right:10px;}}"]),C=s.Ay.button.withConfig({componentId:"jt-app__sc-518baf73-15"})(["width:100%;padding:12px 24px;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:all 0.3s ease;"," &:disabled{background:#f3f4f6;color:#9ca3af;border-color:#e5e7eb;cursor:not-allowed;}"],e=>"primary"===e.variant?"\n    background: #ed7734;\n    color: white;\n    \n    &:hover:not(:disabled) {\n      background: #5a6fd8;\n    }\n  ":"\n    background: transparent;\n    color: #ed7734;\n    border: 2px solid #ed7734;\n    \n    &:hover:not(:disabled) {\n      background: #ed7734;\n      color: white;\n    }\n  "),I=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-16"})(["background:#fef3c7;border:1px solid #f59e0b;border-radius:8px;padding:15px;margin-bottom:20px;.title{font-weight:600;color:#92400e;margin-bottom:5px;}.message{color:#92400e;font-size:14px;margin:0;}"]),L=s.Ay.div.withConfig({componentId:"jt-app__sc-518baf73-17"})(["display:flex;align-items:center;justify-content:center;margin-bottom:30px;gap:15px;label{font-size:16px;color:#333;font-weight:500;}input[type=\"checkbox\"]{width:50px;height:28px;appearance:none;background:#e5e7eb;border-radius:14px;position:relative;cursor:pointer;transition:background 0.3s ease;&:checked{background:#ed7734;}&::after{content:'';position:absolute;width:20px;height:20px;border-radius:50%;background:white;top:4px;left:4px;transition:transform 0.3s ease;}&:checked::after{transform:translateX(22px);}}"]);function k(){let{data:e,status:t}=(0,o.Tk)(),i=(0,a.useRouter)(),[s,k]=(0,r.useState)(!0),[S,B]=(0,r.useState)(null),[N,z]=(0,r.useState)([]),[U,D]=(0,r.useState)(!1),[E,M]=(0,r.useState)("professional"),O=(0,r.useCallback)(async()=>{try{k(!0);let t=null==e?void 0:e.user,i=t.businessId||"biz_"+t.id,[n,r]=await Promise.all([l.getUsageSummary(i),Promise.resolve(l.getAvailablePlans())]);B(n),z(r)}catch(e){console.error("Error loading billing data:",e)}finally{k(!1)}},[e]);(0,r.useEffect)(()=>{if("loading"!==t){if(!(null==e?void 0:e.user))return void i.push("/auth/signin");O()}},[e,t,i,O]);let $=async e=>{console.log("Plan selected:",e)};return"loading"===t||s?(0,n.jsx)(p,{children:(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh"},children:(0,n.jsx)(c.kt,{size:"lg"})})}):(null==e?void 0:e.user)?(0,n.jsx)(p,{children:(0,n.jsxs)(h,{children:[(0,n.jsx)(d.A,{}),(0,n.jsxs)(u,{children:[(0,n.jsx)("h1",{children:"Billing & Usage"}),(0,n.jsx)("p",{children:"Manage your subscription and track location-based usage"})]}),(null==S?void 0:S.overageWarning)&&(0,n.jsxs)(I,{children:[(0,n.jsx)("div",{className:"title",children:"Plan Limit Exceeded"}),(0,n.jsx)("p",{className:"message",children:S.overageWarning})]}),S&&(0,n.jsxs)(g,{children:[(0,n.jsxs)(m,{children:[(0,n.jsxs)(x,{children:[(0,n.jsx)("h3",{children:"Current Plan"}),(0,n.jsx)("p",{children:"Your active subscription"})]}),(0,n.jsx)(v,{children:S.currentPlan}),(0,n.jsx)(j,{children:"Plan Name"})]}),(0,n.jsxs)(m,{children:[(0,n.jsxs)(x,{children:[(0,n.jsx)("h3",{children:"Locations Used"}),(0,n.jsx)("p",{children:"Active locations this month"})]}),(0,n.jsxs)(f,{children:[(0,n.jsx)(b,{$percentage:S.locationsUsed/S.locationsLimit*100,$isOverage:S.locationsUsed>S.locationsLimit}),(0,n.jsxs)(y,{children:[(0,n.jsxs)("span",{children:[S.locationsUsed," of ",S.locationsLimit===1/0?"âˆ":S.locationsLimit]}),(0,n.jsxs)("span",{children:[Math.round(S.locationsUsed/S.locationsLimit*100),"%"]})]})]})]}),(0,n.jsxs)(m,{children:[(0,n.jsxs)(x,{children:[(0,n.jsx)("h3",{children:"Monthly Orders"}),(0,n.jsx)("p",{children:"Total orders across all locations"})]}),(0,n.jsx)(v,{children:S.currentMonthOrders.toLocaleString()}),(0,n.jsx)(j,{children:"Orders This Month"})]}),(0,n.jsxs)(m,{children:[(0,n.jsxs)(x,{children:[(0,n.jsx)("h3",{children:"Estimated Bill"}),(0,n.jsxs)("p",{children:["Next billing date: ",S.nextBillingDate.toLocaleDateString()]})]}),(0,n.jsxs)(v,{children:["$",S.estimatedMonthlyBill.toFixed(2)]}),(0,n.jsx)(j,{children:"Monthly Amount"})]})]}),(0,n.jsxs)("div",{style:{marginBottom:"30px"},children:[(0,n.jsx)("h2",{style:{textAlign:"center",marginBottom:"20px",color:"#333"},children:"Choose Your Plan"}),(0,n.jsxs)(L,{children:[(0,n.jsx)("label",{children:"Monthly"}),(0,n.jsx)("input",{type:"checkbox",checked:U,onChange:e=>D(e.target.checked)}),(0,n.jsxs)("label",{children:["Yearly ",(0,n.jsx)("span",{style:{color:"#10b981",fontWeight:600},children:"Save up to 20%"})]})]}),(0,n.jsx)(g,{children:N.map(e=>{var t;let i=e.id===E,r=U?e.yearlyPrice:e.monthlyPrice,o=((t=e.monthlyPrice)-e.yearlyPrice/12)/t*100;return(0,n.jsxs)(w,{$isSelected:i,onClick:()=>!i&&$(e.id),children:[i&&(0,n.jsx)(A,{children:"Current Plan"}),(0,n.jsxs)(x,{children:[(0,n.jsx)("h3",{children:e.name}),(0,n.jsx)("p",{children:e.description})]}),(0,n.jsxs)(P,{children:["$",r.toFixed(2),(0,n.jsxs)("span",{className:"period",children:["/",U?"year":"month"]}),U&&(0,n.jsxs)("span",{className:"yearly-savings",children:["Save ",o.toFixed(0),"% yearly"]})]}),(0,n.jsx)(_,{children:e.features.map((e,t)=>(0,n.jsx)("li",{children:e},t))}),(0,n.jsx)(C,{variant:i?"secondary":"primary",disabled:i,onClick:()=>$(e.id),children:i?"Current Plan":"Select Plan"})]},e.id)})})]})]})}):null}},35626:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});let n=(0,i(71847).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},40294:(e,t,i)=>{"use strict";i.d(t,{kt:()=>p,lV:()=>h,p8:()=>u});var n=i(95155);i(12115);var r=i(50625);let o=(0,r.i7)(["from{transform:rotate(0deg);}to{transform:rotate(360deg);}"]),a=r.Ay.div.withConfig({componentId:"jt-app__sc-50765fb0-0"})(["animation:"," 1s linear infinite;"," ",""],o,e=>{let{$size:t}=e;switch(t){case"sm":return"width: 1rem; height: 1rem;";case"lg":return"width: 2rem; height: 2rem;";default:return"width: 1.5rem; height: 1.5rem;"}},e=>{let{$color:t,theme:i}=e;switch(t){case"white":return"color: white;";case"gray":return"color: ".concat(i.colors.secondary[600],";");default:return"color: ".concat(i.colors.primary[600],";")}}),s=r.Ay.button.withConfig({componentId:"jt-app__sc-50765fb0-1"})(["display:flex;align-items:center;justify-content:center;gap:0.5rem;&:disabled{opacity:0.5;cursor:not-allowed;}"]),l=r.Ay.div.withConfig({componentId:"jt-app__sc-50765fb0-2"})(["position:relative;"]),c=r.Ay.div.withConfig({componentId:"jt-app__sc-50765fb0-3"})(["position:absolute;inset:0;background:rgba(255,255,255,0.75);display:flex;align-items:center;justify-content:center;z-index:10;border-radius:",";"],e=>{let{theme:t}=e;return t.borderRadius.lg}),d=r.Ay.div.withConfig({componentId:"jt-app__sc-50765fb0-4"})(["text-align:center;p{margin-top:0.5rem;font-size:",";color:",";}"],e=>{let{theme:t}=e;return t.typography.fontSize.sm},e=>{let{theme:t}=e;return t.colors.text.secondary}),p=e=>{let{size:t="md",color:i="orange",className:r=""}=e;return(0,n.jsx)(a,{$size:t,$color:i,className:r,children:(0,n.jsxs)("svg",{width:"100%",height:"100%",fill:"none",viewBox:"0 0 24 24",children:[(0,n.jsx)("circle",{style:{opacity:.25},cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,n.jsx)("path",{style:{opacity:.75},fill:"currentColor",d:"m4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})},h=e=>{let{isLoading:t,children:i,onClick:r,type:o="button",className:a="",disabled:l=!1}=e;return(0,n.jsxs)(s,{type:o,onClick:r,disabled:t||l,className:a,children:[t&&(0,n.jsx)(p,{size:"sm",color:"white"}),(0,n.jsx)("span",{children:i})]})},u=e=>{let{isLoading:t,message:i="Loading...",children:r}=e;return(0,n.jsxs)(l,{children:[r,t&&(0,n.jsx)(c,{children:(0,n.jsxs)(d,{children:[(0,n.jsx)(p,{size:"lg"}),(0,n.jsx)("p",{children:i})]})})]})}},47921:(e,t,i)=>{"use strict";i.d(t,{CP:()=>d,Tk:()=>l,Z2:()=>s,cV:()=>c});var n=i(95155),r=i(58347),o=i(12115);let a=(0,o.createContext)({hasNextAuth:!0}),s=()=>(0,o.useContext)(a);function l(){try{let{hasNextAuth:e}=s();if(!e)return{data:null,status:"unauthenticated"};return(0,r.wV)()}catch(e){return{data:null,status:"loading"}}}function c(){let{hasNextAuth:e}=s();return async t=>{if(e)return(0,r.signOut)(t);localStorage.removeItem("mobile-auth-session"),localStorage.removeItem("mobile-auth-user"),window.location.href="/mobile/login"}}function d(e){let{children:t}=e,[i,s]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{(async()=>{try{let e=new AbortController,t=setTimeout(()=>e.abort(),3e3),i=await fetch("/api/auth/session",{method:"GET",headers:{Accept:"application/json"},signal:e.signal});clearTimeout(t);let n=i.headers.get("content-type");if(i.ok&&(null==n?void 0:n.includes("application/json")))try{await i.json(),s(!0)}catch(e){s(!1)}else s(!1)}catch(e){s(!1)}})()},[]),(0,n.jsx)(a.Provider,{value:{hasNextAuth:i},children:i?(0,n.jsx)(r.CP,{children:t}):(0,n.jsx)(n.Fragment,{children:t})})}},66585:(e,t,i)=>{"use strict";i.d(t,{A:()=>a});var n=i(95155),r=i(35626),o=i(20063);function a(){let e=(0,o.useRouter)();return(0,n.jsxs)("button",{onClick:()=>e.push("/settings"),className:"inline-flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,n.jsx)(r.A,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Back to Settings"})]})}}},e=>{e.O(0,[2207,8347,8441,1255,7358],()=>e(e.s=14587)),_N_E=e.O()}]);