"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5523],{9296:(e,t,i)=>{i.d(t,{A:()=>w});var o=i(95155),a=i(12115),r=i(20063),n=i(52619),s=i.n(n),l=i(50625),c=i(65993),d=i(87066),u=i(52583),h=i(80111),p=i(26989);function g(){let[e,t]=a.useState(!1);return a.useEffect(()=>{let e=()=>{let e=!!window.Capacitor;return console.log("\uD83D\uDD0D Capacitor Check:",{hasWindow:!0,hasCapacitor:e,capacitorObj:window.Capacitor}),t(e),e};if(!e()){let t=setTimeout(e,100);return()=>clearTimeout(t)}},[]),e}let f=l.Ay.nav.withConfig({componentId:"jt-app__sc-c1ec0546-0"})(["position:fixed;bottom:0;left:0;right:0;z-index:1000;padding-bottom:env(safe-area-inset-bottom);background:linear-gradient(180deg,rgba(255,255,255,0.92) 0%,rgba(255,255,255,0.98) 100%);backdrop-filter:blur(30px);border-top:1px solid rgba(237,119,52,0.1);box-shadow:0 -10px 30px -5px rgba(0,0,0,0.1),0 -2px 10px rgba(237,119,52,0.05);&::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(to right,transparent,rgba(237,119,52,0.3),transparent);}"]),b=l.Ay.div.withConfig({componentId:"jt-app__sc-c1ec0546-1"})(["display:flex;align-items:center;justify-content:space-around;padding:0.75rem 1rem;max-width:500px;margin:0 auto;"]),m=(0,l.Ay)(s()).withConfig({componentId:"jt-app__sc-c1ec0546-2"})(["display:flex;flex-direction:column;align-items:center;gap:0.3rem;padding:0.6rem 0.9rem;border-radius:16px;text-decoration:none;transition:all 300ms cubic-bezier(0.4,0,0.2,1);min-width:70px;position:relative;background:",";&::before{content:'';position:absolute;top:-2px;left:50%;transform:translateX(-50%) scaleX(",");width:32px;height:3px;background:linear-gradient(to right,#ed7734,#f59e0b);border-radius:0 0 3px 3px;transition:transform 300ms cubic-bezier(0.34,1.56,0.64,1);}&::after{content:'';position:absolute;inset:0;border-radius:16px;background:linear-gradient(135deg,rgba(237,119,52,0.2),rgba(246,188,137,0.2));opacity:",";filter:blur(8px);z-index:-1;transition:opacity 300ms ease;}svg{width:26px;height:26px;color:",";transition:all 300ms cubic-bezier(0.34,1.56,0.64,1);filter:",";}span{font-size:0.7rem;font-weight:",";color:",";transition:all 300ms ease;letter-spacing:0.02em;}&:active{transform:scale(0.92);background:",";}&:hover{background:",";transform:translateY(-2px);svg{transform:scale(1.1);color:",";}span{color:",";}}"],e=>e.$active?"linear-gradient(135deg, rgba(237, 119, 52, 0.15) 0%, rgba(246, 188, 137, 0.12) 100%)":"transparent",e=>e.$active?"1":"0",e=>e.$active?"1":"0",e=>e.$active?"#ed7734":"#78716c",e=>e.$active?"drop-shadow(0 2px 4px rgba(237, 119, 52, 0.3))":"none",e=>e.$active?"600":"500",e=>e.$active?"#ed7734":"#78716c",e=>e.$active?"linear-gradient(135deg, rgba(237, 119, 52, 0.2) 0%, rgba(246, 188, 137, 0.15) 100%)":"rgba(245, 245, 244, 0.8)",e=>e.$active?"linear-gradient(135deg, rgba(237, 119, 52, 0.18) 0%, rgba(246, 188, 137, 0.14) 100%)":"rgba(243, 244, 246, 0.8)",e=>(e.$active,"#ed7734"),e=>(e.$active,"#ed7734")),v=[{path:"/mobile/dashboard",label:"Dashboard",icon:(0,o.jsx)(c.A,{})},{path:"/mobile/orders-hub",label:"Orders",icon:(0,o.jsx)(d.A,{})},{path:"/mobile/scan",label:"Scan QR",icon:(0,o.jsx)(u.A,{})},{path:"/mobile/qr",label:"QR Code",icon:(0,o.jsx)(h.A,{})},{path:"/mobile/settings",label:"Settings",icon:(0,o.jsx)(p.A,{})}];function w(){let e=(0,r.usePathname)(),t=g(),i=function(){let e=(0,r.usePathname)(),t=g(),i="/mobile"===e||"/mobile/"===e,o=null==e?void 0:e.startsWith("/mobile/settings"),a=t&&((null==e?void 0:e.startsWith("/mobile/"))||"/mobile"===e)&&!o&&!i;return console.log("Navigation Debug:",{pathname:e,isMobileApp:t,isHomePage:i,isSettingsPage:o,shouldShow:a,isCapacitor:!!window.Capacitor}),a}();return(a.useEffect(()=>{console.log("\uD83D\uDEA8 BottomNavigation Component Render:",{pathname:e,isMobileApp:t,shouldShow:i,hasCapacitor:!!window.Capacitor,windowObject:"object"})}),i)?(console.log("✅ BottomNavigation RENDERING WITH",v.length,"items"),(0,o.jsx)(f,{children:(0,o.jsx)(b,{children:v.map(t=>{let i=e===t.path;return(0,o.jsxs)(m,{href:t.path,$active:i,children:[t.icon,(0,o.jsx)("span",{children:t.label})]},t.path)})})})):(console.log("❌ BottomNavigation returning null - shouldShow is false"),null)}},65523:(e,t,i)=>{i.r(t),i.d(t,{default:()=>h,useMobileLayout:()=>p});var o=i(95155),a=i(12115),r=i(50625),n=i(9296),s=i(20063),l=i(72923);function c(e){let{children:t,userId:i,userRole:r}=e,n=(0,s.useRouter)();return(0,a.useEffect)(()=>{if(!i||!r)return void console.log("Push notifications: Waiting for user context...");(async()=>{console.log("\uD83D\uDD14 Initializing push notifications for ".concat(r,": ").concat(i)),await l.B.initialize({userId:i,userRole:r})?(await l.B.setupDefaultChannels(),console.log("✅ Push notifications ready")):console.log("⚠️ Push notifications not available or permission denied")})();let e=e=>{console.log("Order notification received:",e.detail)};return window.addEventListener("orderNotificationReceived",e),()=>{window.removeEventListener("orderNotificationReceived",e),l.B.cleanup()}},[i,r,n]),(0,o.jsx)(o.Fragment,{children:t})}let d=r.Ay.div.withConfig({componentId:"jt-app__sc-a5beb22e-0"})(["min-height:100vh;display:flex;flex-direction:column;padding-top:env(safe-area-inset-top);padding-left:env(safe-area-inset-left);padding-right:env(safe-area-inset-right);"]),u=r.Ay.main.withConfig({componentId:"jt-app__sc-a5beb22e-1"})(["flex:1;position:relative;overflow-x:hidden;"]);function h(e){let{children:t,className:i,hideBottomNav:r=!1}=e,[s,l]=(0,a.useState)({});return(0,a.useEffect)(()=>{try{let e=localStorage.getItem("mobile_auth_user");if(e){let t=JSON.parse(e);l({userId:t.id,userRole:t.role})}}catch(e){console.log("Failed to load user context:",e)}},[]),(0,o.jsx)(c,{userId:s.userId,userRole:s.userRole,children:(0,o.jsxs)(d,{className:i,children:[(0,o.jsx)(u,{children:t}),!r&&(0,o.jsx)(n.A,{})]})})}function p(){return{isMobile:function(){let[e,t]=a.useState(!1);return a.useEffect(()=>{t(!!window.Capacitor)},[]),e}(),safeAreaBottom:"env(safe-area-inset-bottom)",safeAreaTop:"env(safe-area-inset-top)"}}},72923:(e,t,i)=>{i.d(t,{B:()=>r});var o=i(32587),a=i(81494);i(12115);class r{static async initialize(e){if(!o.Ii.isNativePlatform())return console.log("Push notifications only available on native platforms"),!1;this.userId=e.userId,this.userRole=e.userRole;try{let e=await a.h.requestPermissions();if("granted"===e.receive)return await a.h.register(),this.setupListeners(),console.log("✅ Push notifications initialized successfully"),!0;return console.warn("⚠️ Push notification permission denied"),!1}catch(e){return console.error("❌ Failed to initialize push notifications:",e),!1}}static setupListeners(){let e=a.h.addListener("registration",async e=>{this.deviceToken=e.value,console.log("\uD83D\uDCF1 Device token received:",e.value),await this.registerDeviceWithBackend(e.value)});this.listeners.push(e);let t=a.h.addListener("registrationError",e=>{console.error("❌ Push registration error:",e)});this.listeners.push(t);let i=a.h.addListener("pushNotificationReceived",e=>{console.log("\uD83D\uDD14 Notification received (foreground):",e),this.handleForegroundNotification(e)});this.listeners.push(i);let o=a.h.addListener("pushNotificationActionPerformed",e=>{console.log("\uD83D\uDC46 Notification action:",e),this.handleNotificationAction(e)});this.listeners.push(o)}static async registerDeviceWithBackend(e){if(!this.userId||!this.userRole)return void console.warn("User info not set, skipping backend registration");try{(await fetch("/api/push/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,userRole:this.userRole,deviceToken:e,platform:o.Ii.getPlatform(),timestamp:new Date().toISOString()})})).ok?console.log("✅ Device registered with backend"):console.error("❌ Failed to register device with backend")}catch(e){console.error("❌ Error registering device:",e)}}static handleForegroundNotification(e){let t=e.data;console.log("Foreground notification:",{title:e.title,body:e.body,data:t}),(null==t?void 0:t.type)&&(null==t?void 0:t.orderId)&&this.handleOrderNotification(t)}static handleNotificationAction(e){let t=e.notification.data;console.log("User tapped notification:",t),t.type&&t.orderId?this.navigateToOrder(t.orderId):t.type&&t.claimId&&this.navigatToFraudClaim(t.claimId)}static handleOrderNotification(e){let t=new CustomEvent("orderNotificationReceived",{detail:e});window.dispatchEvent(t)}static navigateToOrder(e){window.location.href="/mobile/orders/".concat(e)}static navigatToFraudClaim(e){window.location.href="/mobile/fraud-claims?claim=".concat(e)}static async sendNotificationToUser(e,t){try{return(await fetch("/api/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:e,notification:t})})).ok}catch(e){return console.error("Failed to send notification:",e),!1}}static async sendNotificationToRole(e,t){try{return(await fetch("/api/push/send-to-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:e,notification:t})})).ok}catch(e){return console.error("Failed to send notification to role:",e),!1}}static async getDeliveryChannels(){return(await a.h.listChannels()).channels}static async createChannel(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;"android"===o.Ii.getPlatform()&&await a.h.createChannel({id:e,name:t,importance:i,sound:"default",vibration:!0,lights:!0,lightColor:"#ED7734"})}static async setupDefaultChannels(){"android"===o.Ii.getPlatform()&&(await this.createChannel("orders","Order Updates",5),await this.createChannel("fraud","Fraud Alerts",5),await this.createChannel("general","General Notifications",3))}static getDeviceToken(){return this.deviceToken}static isAvailable(){return o.Ii.isNativePlatform()}static cleanup(){this.listeners.forEach(e=>e.remove()),this.listeners=[]}static async notifyOrderStatus(e,t,i,o){return await this.sendNotificationToUser(o,{title:"Order ".concat(t),body:{pending:"\uD83D\uDCCB Your order has been received",in_progress:"\uD83D\uDC68‍\uD83C\uDF73 Your order is being prepared",ready:"✅ Your order is ready for pickup!",picked_up:"\uD83D\uDE97 Your order has been picked up",delivered:"\uD83C\uDF89 Your order has been delivered!",cancelled:"❌ Your order has been cancelled"}[i]||"Order status updated",data:{type:"order_status",orderId:e,orderNumber:t,status:i}})}static async notifyNewFraudClaim(e,t){return await this.sendNotificationToRole("admin",{title:"\uD83D\uDEA8 New Fraud Claim",body:"Claim ".concat(e," filed for order ").concat(t),data:{type:"new_fraud_claim",claimNumber:e,orderNumber:t}})}}r.deviceToken=null,r.userId=null,r.userRole=null,r.listeners=[]}}]);