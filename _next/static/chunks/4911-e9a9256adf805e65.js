"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4911],{16906:(e,i,t)=>{t.d(i,{A:()=>q});var r=t(95155),n=t(12115),o=t(50625),a=t(1733),s=t(26497),d=t(52056),c=t(65229),l=t(42529),p=t(95664),u=t(42348),h=t(89715),f=t(72923);let m=(0,o.Ay)(a.P.div).withConfig({componentId:"jt-app__sc-f15ad615-0"})(["position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(4px);display:flex;align-items:center;justify-content:center;z-index:10000;padding:1rem;"]),g=(0,o.Ay)(a.P.div).withConfig({componentId:"jt-app__sc-f15ad615-1"})(["background:white;border-radius:16px;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,0.3);position:relative;"]),b=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-2"})(["padding:1.5rem;border-bottom:1px solid #e5e7eb;position:sticky;top:0;background:white;z-index:10;border-radius:16px 16px 0 0;"]),x=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-3"})(["display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:0.5rem;"]),v=o.Ay.h2.withConfig({componentId:"jt-app__sc-f15ad615-4"})(["font-size:1.5rem;font-weight:700;color:#1f2937;margin:0;display:flex;align-items:center;gap:0.5rem;"]),y=o.Ay.button.withConfig({componentId:"jt-app__sc-f15ad615-5"})(["background:none;border:none;padding:0.5rem;cursor:pointer;color:#6b7280;border-radius:8px;transition:all 0.2s;&:hover{background:#f3f4f6;color:#1f2937;}"]),j=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-6"})(["background:#fef7ee;padding:0.75rem;border-radius:8px;margin-top:0.75rem;font-size:0.875rem;color:#92400e;"]),w=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-7"})(["padding:1.5rem;"]),C=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-8"})(["margin-bottom:1.5rem;"]),_=o.Ay.label.withConfig({componentId:"jt-app__sc-f15ad615-9"})(["display:block;font-size:0.875rem;font-weight:600;color:#374151;margin-bottom:0.5rem;"]),k=o.Ay.span.withConfig({componentId:"jt-app__sc-f15ad615-10"})(["color:#ef4444;margin-left:0.25rem;"]),I=o.Ay.select.withConfig({componentId:"jt-app__sc-f15ad615-11"})(["width:100%;padding:0.75rem;border:2px solid #e5e7eb;border-radius:8px;font-size:1rem;transition:all 0.2s;background:white;&:focus{outline:none;border-color:#f97316;box-shadow:0 0 0 3px rgba(249,115,22,0.1);}"]),A=o.Ay.textarea.withConfig({componentId:"jt-app__sc-f15ad615-12"})(["width:100%;padding:0.75rem;border:2px solid #e5e7eb;border-radius:8px;font-size:1rem;min-height:120px;resize:vertical;font-family:inherit;transition:all 0.2s;&:focus{outline:none;border-color:#f97316;box-shadow:0 0 0 3px rgba(249,115,22,0.1);}"]),N=o.Ay.input.withConfig({componentId:"jt-app__sc-f15ad615-13"})(['width:100%;padding:0.75rem;border:2px solid #e5e7eb;border-radius:8px;font-size:1rem;transition:all 0.2s;&:focus{outline:none;border-color:#f97316;box-shadow:0 0 0 3px rgba(249,115,22,0.1);}&[type="file"]{padding:0.5rem;}']),P=o.Ay.p.withConfig({componentId:"jt-app__sc-f15ad615-14"})(["font-size:0.75rem;color:#6b7280;margin:0.5rem 0 0 0;"]),S=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-15"})(["background:#f9fafb;padding:1rem;border-radius:8px;margin-top:0.5rem;"]),T=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-16"})(["display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0;font-size:0.875rem;color:#374151;svg{color:#10b981;}"]),z=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-17"})(["border:2px dashed #d1d5db;border-radius:8px;padding:1.5rem;text-align:center;cursor:pointer;transition:all 0.2s;margin-top:0.5rem;&:hover{border-color:#f97316;background:#fef7ee;}"]),E=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-18"})(["color:#9ca3af;margin-bottom:0.5rem;display:flex;justify-content:center;"]),L=o.Ay.p.withConfig({componentId:"jt-app__sc-f15ad615-19"})(["font-size:0.875rem;color:#6b7280;margin:0;"]),O=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-20"})(["margin-top:0.75rem;"]),R=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-21"})(["display:flex;align-items:center;justify-content:space-between;padding:0.5rem;background:white;border-radius:6px;font-size:0.875rem;margin-bottom:0.5rem;"]),F=o.Ay.button.withConfig({componentId:"jt-app__sc-f15ad615-22"})(["background:none;border:none;color:#ef4444;cursor:pointer;padding:0.25rem;border-radius:4px;transition:all 0.2s;&:hover{background:#fee2e2;}"]),D=o.Ay.div.withConfig({componentId:"jt-app__sc-f15ad615-23"})(["padding:1.5rem;border-top:1px solid #e5e7eb;display:flex;gap:0.75rem;background:#f9fafb;border-radius:0 0 16px 16px;position:sticky;bottom:0;"]),U=o.Ay.button.withConfig({componentId:"jt-app__sc-f15ad615-24"})(["flex:1;padding:0.875rem 1.5rem;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:all 0.2s;border:none;display:flex;align-items:center;justify-content:center;gap:0.5rem;",""],e=>"primary"===e.$variant?"\n    background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);\n    color: white;\n    \n    &:hover:not(:disabled) {\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);\n    }\n    \n    &:disabled {\n      opacity: 0.6;\n      cursor: not-allowed;\n    }\n  ":"\n    background: white;\n    color: #374151;\n    border: 2px solid #e5e7eb;\n    \n    &:hover {\n      background: #f9fafb;\n    }\n  ");function q(e){let{isOpen:i,onClose:t,order:o,businessId:a,customerId:q,onSubmitSuccess:B,qrEvidence:Y}=e,[$,J]=(0,n.useState)("customer_never_received"),[W,X]=(0,n.useState)("medium"),[G,H]=(0,n.useState)(""),[M,Q]=(0,n.useState)(""),[V,K]=(0,n.useState)([]),[Z,ee]=(0,n.useState)(""),[ei,et]=(0,n.useState)(!1),er=(0,n.useRef)(null),en=async e=>{if(e.preventDefault(),!G.trim())return void alert("Please provide a description of the issue");et(!0);try{let e={businessId:a,customerId:q||a,orderId:o.id,orderNumber:o.orderNumber,claimType:$,status:"pending",priority:W,description:G,customerName:o.customerName,customerEmail:o.customerEmail,customerPhone:M||o.customerEmail,driverName:o.driverName,orderDate:o.createdAt,orderTotal:0,evidence:{qrScanned:(null==Y?void 0:Y.qrScanned)||!1,scanTimestamp:null==Y?void 0:Y.scanTimestamp,scanLocation:null==Y?void 0:Y.scanLocation,gpsCoordinates:null==Y?void 0:Y.gpsCoordinates,photoProof:[],additionalNotes:Z}},i=await fetch("/api/fraud-claims",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!i.ok)throw Error("Failed to submit claim");let r=await i.json();await f.B.notifyNewFraudClaim(r.claimNumber,o.orderNumber),B&&B(r),t()}catch(e){console.error("Error submitting fraud claim:",e),alert("Failed to submit fraud claim. Please try again.")}finally{et(!1)}};return(0,r.jsx)(s.N,{children:i&&(0,r.jsx)(m,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,children:(0,r.jsx)(g,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},onClick:e=>e.stopPropagation(),children:(0,r.jsxs)("form",{onSubmit:en,children:[(0,r.jsxs)(b,{children:[(0,r.jsxs)(x,{children:[(0,r.jsxs)(v,{children:[(0,r.jsx)(d.A,{size:24}),"Report Fraud / Issue"]}),(0,r.jsx)(y,{onClick:t,type:"button",children:(0,r.jsx)(c.A,{size:24})})]}),(0,r.jsxs)(j,{children:[(0,r.jsxs)("strong",{children:["Order #",o.orderNumber]})," • ",o.customerName]})]}),(0,r.jsxs)(w,{children:[(0,r.jsxs)(C,{children:[(0,r.jsxs)(_,{children:["Issue Type",(0,r.jsx)(k,{children:"*"})]}),(0,r.jsxs)(I,{value:$,onChange:e=>J(e.target.value),required:!0,children:[(0,r.jsx)("option",{value:"customer_never_received",children:"Customer Never Received Order"}),(0,r.jsx)("option",{value:"driver_dispute",children:"Driver Dispute"}),(0,r.jsx)("option",{value:"suspicious_activity",children:"Suspicious Activity"}),(0,r.jsx)("option",{value:"wrong_delivery",children:"Wrong Delivery Address"}),(0,r.jsx)("option",{value:"quality_issue",children:"Quality/Accuracy Issue"})]})]}),(0,r.jsxs)(C,{children:[(0,r.jsxs)(_,{children:["Priority Level",(0,r.jsx)(k,{children:"*"})]}),(0,r.jsxs)(I,{value:W,onChange:e=>X(e.target.value),required:!0,children:[(0,r.jsx)("option",{value:"low",children:"Low - Minor issue, no financial impact"}),(0,r.jsx)("option",{value:"medium",children:"Medium - Standard investigation needed"}),(0,r.jsx)("option",{value:"high",children:"High - Significant financial impact"}),(0,r.jsx)("option",{value:"critical",children:"Critical - Urgent attention required"})]})]}),(0,r.jsxs)(C,{children:[(0,r.jsxs)(_,{children:["Description",(0,r.jsx)(k,{children:"*"})]}),(0,r.jsx)(A,{value:G,onChange:e=>H(e.target.value),placeholder:"Provide detailed information about the issue...",required:!0}),(0,r.jsx)(P,{children:"Include specific details, times, and circumstances"})]}),(0,r.jsxs)(C,{children:[(0,r.jsx)(_,{children:"Contact Phone Number"}),(0,r.jsx)(N,{type:"tel",value:M,onChange:e=>Q(e.target.value),placeholder:"(555) 123-4567"}),(0,r.jsx)(P,{children:"Optional - for follow-up communication"})]}),Y&&Y.qrScanned&&(0,r.jsxs)(C,{children:[(0,r.jsx)(_,{children:"Collected Evidence"}),(0,r.jsxs)(S,{children:[(0,r.jsxs)(T,{children:[(0,r.jsx)(l.A,{size:16}),"QR Code Scanned"]}),Y.scanTimestamp&&(0,r.jsxs)(T,{children:[(0,r.jsx)(l.A,{size:16}),"Scan Time: ",new Date(Y.scanTimestamp).toLocaleString()]}),Y.scanLocation&&(0,r.jsxs)(T,{children:[(0,r.jsx)(l.A,{size:16}),"Location: ",Y.scanLocation]}),Y.gpsCoordinates&&(0,r.jsxs)(T,{children:[(0,r.jsx)(l.A,{size:16}),"GPS Coordinates Recorded"]})]})]}),(0,r.jsxs)(C,{children:[(0,r.jsx)(_,{children:"Photo Evidence (Optional)"}),(0,r.jsx)("input",{ref:er,type:"file",accept:"image/*",multiple:!0,onChange:e=>{if(e.target.files){let i=Array.from(e.target.files).slice(0,5-V.length);K(e=>[...e,...i])}},style:{display:"none"}}),(0,r.jsxs)(z,{onClick:()=>{var e;return null==(e=er.current)?void 0:e.click()},children:[(0,r.jsx)(E,{children:(0,r.jsx)(p.A,{size:32})}),(0,r.jsx)(L,{children:"Click to upload photos (max 5)"})]}),V.length>0&&(0,r.jsx)(O,{children:V.map((e,i)=>(0,r.jsxs)(R,{children:[(0,r.jsx)("span",{children:e.name}),(0,r.jsx)(F,{onClick:()=>{K(e=>e.filter((e,t)=>t!==i))},type:"button",children:(0,r.jsx)(c.A,{size:16})})]},i))})]}),(0,r.jsxs)(C,{children:[(0,r.jsx)(_,{children:"Additional Notes"}),(0,r.jsx)(A,{value:Z,onChange:e=>ee(e.target.value),placeholder:"Any other relevant information...",style:{minHeight:"80px"}})]})]}),(0,r.jsxs)(D,{children:[(0,r.jsx)(U,{type:"button",$variant:"secondary",onClick:t,children:"Cancel"}),(0,r.jsx)(U,{type:"submit",$variant:"primary",disabled:ei,children:ei?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(u.A,{size:20,className:"spinning"}),"Submitting..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.A,{size:20}),"Submit Claim"]})})]})]})})})})}o.Ay.span.withConfig({componentId:"jt-app__sc-f15ad615-25"})(["display:inline-block;padding:0.25rem 0.75rem;border-radius:12px;font-size:0.75rem;font-weight:600;",""],e=>{switch(e.$priority){case"critical":return"background: #fef2f2; color: #991b1b;";case"high":return"background: #fef3c7; color: #92400e;";case"medium":return"background: #dbeafe; color: #1e40af;";default:return"background: #f3f4f6; color: #4b5563;"}})},72923:(e,i,t)=>{t.d(i,{B:()=>o});var r=t(32587),n=t(81494);t(12115);class o{static async initialize(e){if(!r.Ii.isNativePlatform())return console.log("Push notifications only available on native platforms"),!1;this.userId=e.userId,this.userRole=e.userRole;try{let e=await n.h.requestPermissions();if("granted"===e.receive)return await n.h.register(),this.setupListeners(),console.log("✅ Push notifications initialized successfully"),!0;return console.warn("⚠️ Push notification permission denied"),!1}catch(e){return console.error("❌ Failed to initialize push notifications:",e),!1}}static setupListeners(){let e=n.h.addListener("registration",async e=>{this.deviceToken=e.value,console.log("\uD83D\uDCF1 Device token received:",e.value),await this.registerDeviceWithBackend(e.value)});this.listeners.push(e);let i=n.h.addListener("registrationError",e=>{console.error("❌ Push registration error:",e)});this.listeners.push(i);let t=n.h.addListener("pushNotificationReceived",e=>{console.log("\uD83D\uDD14 Notification received (foreground):",e),this.handleForegroundNotification(e)});this.listeners.push(t);let r=n.h.addListener("pushNotificationActionPerformed",e=>{console.log("\uD83D\uDC46 Notification action:",e),this.handleNotificationAction(e)});this.listeners.push(r)}static async registerDeviceWithBackend(e){if(!this.userId||!this.userRole)return void console.warn("User info not set, skipping backend registration");try{(await fetch("/api/push/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:this.userId,userRole:this.userRole,deviceToken:e,platform:r.Ii.getPlatform(),timestamp:new Date().toISOString()})})).ok?console.log("✅ Device registered with backend"):console.error("❌ Failed to register device with backend")}catch(e){console.error("❌ Error registering device:",e)}}static handleForegroundNotification(e){let i=e.data;console.log("Foreground notification:",{title:e.title,body:e.body,data:i}),(null==i?void 0:i.type)&&(null==i?void 0:i.orderId)&&this.handleOrderNotification(i)}static handleNotificationAction(e){let i=e.notification.data;console.log("User tapped notification:",i),i.type&&i.orderId?this.navigateToOrder(i.orderId):i.type&&i.claimId&&this.navigatToFraudClaim(i.claimId)}static handleOrderNotification(e){let i=new CustomEvent("orderNotificationReceived",{detail:e});window.dispatchEvent(i)}static navigateToOrder(e){window.location.href="/mobile/orders/".concat(e)}static navigatToFraudClaim(e){window.location.href="/mobile/fraud-claims?claim=".concat(e)}static async sendNotificationToUser(e,i){try{return(await fetch("/api/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetUserId:e,notification:i})})).ok}catch(e){return console.error("Failed to send notification:",e),!1}}static async sendNotificationToRole(e,i){try{return(await fetch("/api/push/send-to-role",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({role:e,notification:i})})).ok}catch(e){return console.error("Failed to send notification to role:",e),!1}}static async getDeliveryChannels(){return(await n.h.listChannels()).channels}static async createChannel(e,i){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4;"android"===r.Ii.getPlatform()&&await n.h.createChannel({id:e,name:i,importance:t,sound:"default",vibration:!0,lights:!0,lightColor:"#ED7734"})}static async setupDefaultChannels(){"android"===r.Ii.getPlatform()&&(await this.createChannel("orders","Order Updates",5),await this.createChannel("fraud","Fraud Alerts",5),await this.createChannel("general","General Notifications",3))}static getDeviceToken(){return this.deviceToken}static isAvailable(){return r.Ii.isNativePlatform()}static cleanup(){this.listeners.forEach(e=>e.remove()),this.listeners=[]}static async notifyOrderStatus(e,i,t,r){return await this.sendNotificationToUser(r,{title:"Order ".concat(i),body:{pending:"\uD83D\uDCCB Your order has been received",in_progress:"\uD83D\uDC68‍\uD83C\uDF73 Your order is being prepared",ready:"✅ Your order is ready for pickup!",picked_up:"\uD83D\uDE97 Your order has been picked up",delivered:"\uD83C\uDF89 Your order has been delivered!",cancelled:"❌ Your order has been cancelled"}[t]||"Order status updated",data:{type:"order_status",orderId:e,orderNumber:i,status:t}})}static async notifyNewFraudClaim(e,i){return await this.sendNotificationToRole("admin",{title:"\uD83D\uDEA8 New Fraud Claim",body:"Claim ".concat(e," filed for order ").concat(i),data:{type:"new_fraud_claim",claimNumber:e,orderNumber:i}})}}o.deviceToken=null,o.userId=null,o.userRole=null,o.listeners=[]},97936:(e,i,t)=>{t.d(i,{j2:()=>s,v7:()=>d,wN:()=>a});var r=t(95704);let n="https://thejerktracker0.vercel.app";function o(e){if(e)return e.replace(/\/$/,"")}function a(){var e,i,t;let a=o("https://thejerktracker0.vercel.app".trim()||(null==(t=r.env.NEXT_PUBLIC_APP_URL)?void 0:t.trim())||(r.env.NEXT_PUBLIC_VERCEL_URL?"https://".concat(r.env.NEXT_PUBLIC_VERCEL_URL):void 0));return a||((null==(e=window.location)?void 0:e.origin)&&null!=(i=o(window.location.origin))?i:n)}function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=a();if(!e)return i;if(/^https?:\/\//i.test(e))return e;let t=e.startsWith("/")?e:"/".concat(e);return"".concat(i).concat(t)}function d(e){let i=encodeURIComponent(e);return s("/orders/".concat(i))}}}]);