"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[811],{12811:(e,t,r)=>{r.d(t,{U:()=>m});var n=r(38401),a=r(82671),o=r(96625),i=r(69497),s=r(92493),c=r.n(s),l=r(75698),u=r(7390),d=r(86931),p=r(98060);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,i.A)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var m=function(){var e,t,r,s,g,m,h,b,y,v,k;return(0,o.A)(function e(){(0,a.A)(this,e)},null,[{key:"getConfig",value:function(){return{region:"us-east-1",tableName:"jerktracker-orders",enableDynamoDB:!0,fallbackMode:!1}}},{key:"initClient",value:(e=(0,n.A)(c().mark(function e(){var t,r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.client){e.next=2;break}return e.abrupt("return",this.client);case 2:if(!(!(t=this.getConfig()).enableDynamoDB||t.fallbackMode)){e.next=7;break}return console.log("DynamoDB disabled or in fallback mode, using localStorage"),this.fallbackMode=!0,e.abrupt("return",null);case 7:e.prev=7;r=new l.M({region:t.region,credentials:(0,d.s)({identityPoolId:"us-east-1:30ec5223-85d6-4572-8285-71f92d6062e0",clientConfig:{region:t.region}})}),e.next=17;break;case 14:return console.warn("No Cognito Identity Pool configured, falling back to localStorage"),this.fallbackMode=!0,e.abrupt("return",null);case 17:e.next=20;break;case 19:r=new l.M({region:t.region,credentials:{accessKeyId:p.env.AWS_ACCESS_KEY_ID||"",secretAccessKey:p.env.AWS_SECRET_ACCESS_KEY||""}});case 20:return this.client=u.TG.from(r),e.next=23,this.testConnection();case 23:return console.log("DynamoDB client initialized successfully"),e.abrupt("return",this.client);case 27:return e.prev=27,e.t0=e.catch(7),console.error("Failed to initialize DynamoDB client:",e.t0),this.fallbackMode=!0,e.abrupt("return",null);case 32:case"end":return e.stop()}},e,this,[[7,27]])})),function(){return e.apply(this,arguments)})},{key:"testConnection",value:(t=(0,n.A)(c().mark(function e(){var t,r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.client){e.next=3;break}return e.abrupt("return",!1);case 3:return t=this.getConfig(),r="connection-test-"+Date.now(),e.next=7,this.client.send(new u.Z$({TableName:t.tableName,Item:{id:r,orderNumber:"TEST",customerName:"Connection Test",customerEmail:"test@test.com",orderDetails:"Connection test order",status:"pending",createdAt:new Date().toISOString()}}));case 7:return e.next=9,this.client.send(new u.s$({TableName:t.tableName,Key:{id:r}}));case 9:return e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(0),console.error("DynamoDB connection test failed:",e.t0),e.abrupt("return",!1);case 16:case"end":return e.stop()}},e,this,[[0,12]])})),function(){return t.apply(this,arguments)})},{key:"getStorageKey",value:function(){return"".concat("jerktracker_orders","_").concat("prod")}},{key:"getStorage",value:function(){try{var e="jerktracker_storage_test_"+Date.now(),t=JSON.stringify({test:!0,timestamp:Date.now()});localStorage.setItem(e,t);var r=localStorage.getItem(e);if(localStorage.removeItem(e),r!==t)throw Error("localStorage test failed");return{getItem:function(e){return localStorage.getItem(e)},setItem:function(e,t){return localStorage.setItem(e,t)},available:!0}}catch(e){console.warn("localStorage not available, using sessionStorage fallback:",e);try{var n="jerktracker_session_test_"+Date.now(),a=JSON.stringify({test:!0,timestamp:Date.now()});sessionStorage.setItem(n,a);var o=sessionStorage.getItem(n);if(sessionStorage.removeItem(n),o===a)return{getItem:function(e){return sessionStorage.getItem(e)},setItem:function(e,t){return sessionStorage.setItem(e,t)},available:!0}}catch(e){console.warn("sessionStorage also not available:",e)}var i={};return{getItem:function(e){return i[e]||null},setItem:function(e,t){i[e]=t},available:!1}}}},{key:"createOrder",value:(r=(0,n.A)(c().mark(function e(t){var r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initClient();case 2:if(!((r=e.sent)&&!this.fallbackMode)){e.next=7;break}return e.abrupt("return",this.createOrderDynamoDB(t,r));case 7:return console.log("Using localStorage fallback for createOrder"),e.abrupt("return",this.createOrderLocal(t));case 9:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"getAllOrders",value:(s=(0,n.A)(c().mark(function e(){var t;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initClient();case 2:if(!((t=e.sent)&&!this.fallbackMode)){e.next=7;break}return e.abrupt("return",this.getAllOrdersDynamoDB(t));case 7:return console.log("Using localStorage fallback for getAllOrders"),e.abrupt("return",this.getAllOrdersLocal());case 9:case"end":return e.stop()}},e,this)})),function(){return s.apply(this,arguments)})},{key:"getOrderById",value:(g=(0,n.A)(c().mark(function e(t){var r;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initClient();case 2:if(!((r=e.sent)&&!this.fallbackMode)){e.next=7;break}return e.abrupt("return",this.getOrderByIdDynamoDB(t,r));case 7:return console.log("Using localStorage fallback for getOrderById"),e.abrupt("return",this.getOrderByIdLocal(t));case 9:case"end":return e.stop()}},e,this)})),function(e){return g.apply(this,arguments)})},{key:"updateOrder",value:(m=(0,n.A)(c().mark(function e(t,r){var n;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initClient();case 2:if(!((n=e.sent)&&!this.fallbackMode)){e.next=7;break}return e.abrupt("return",this.updateOrderDynamoDB(t,r,n));case 7:return console.log("Using localStorage fallback for updateOrder"),e.abrupt("return",this.updateOrderLocal(t,r));case 9:case"end":return e.stop()}},e,this)})),function(e,t){return m.apply(this,arguments)})},{key:"getServiceStatus",value:(h=(0,n.A)(c().mark(function e(){var t,r,n,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getConfig(),e.next=3,this.initClient();case 3:return r=e.sent,n=this.getStorage(),a="memory",r&&!this.fallbackMode?a="dynamodb":n.available&&(a="undefined"!=typeof localStorage?"localStorage":"sessionStorage"),e.abrupt("return",{dynamoDBAvailable:!!r&&!this.fallbackMode,fallbackMode:this.fallbackMode,storageType:a,region:t.region,tableName:t.tableName});case 8:case"end":return e.stop()}},e,this)})),function(){return h.apply(this,arguments)})},{key:"createOrderDynamoDB",value:(b=(0,n.A)(c().mark(function e(t,r){var n,a,o,i;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getConfig(),a=f(f({},t),{},{id:Date.now().toString()+"_"+Math.random().toString(36).substr(2,9),createdAt:new Date}),e.prev=2,i=f(f({},a),{},{createdAt:a.createdAt.toISOString(),pickedUpAt:null==(o=a.pickedUpAt)?void 0:o.toISOString()}),e.next=6,r.send(new u.Z$({TableName:n.tableName,Item:i}));case 6:return console.log("Order created in DynamoDB:",a.id),this.createOrderLocal(a),e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(2),console.error("Error creating order in DynamoDB:",e.t0),e.abrupt("return",this.createOrderLocal(t));case 15:case"end":return e.stop()}},e,this,[[2,11]])})),function(e,t){return b.apply(this,arguments)})},{key:"getAllOrdersDynamoDB",value:(y=(0,n.A)(c().mark(function e(t){var r,n,a;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.getConfig(),e.prev=1,e.next=4,t.send(new u.Zy({TableName:r.tableName}));case 4:if(n=(e.sent.Items||[]).map(function(e){return f(f({},e),{},{createdAt:new Date(e.createdAt),pickedUpAt:e.pickedUpAt?new Date(e.pickedUpAt):void 0})}),console.log("Loaded ".concat(n.length," orders from DynamoDB")),(a=this.getStorage()).available)try{a.setItem(this.getStorageKey(),JSON.stringify(n))}catch(e){console.warn("Failed to cache orders in localStorage:",e)}return e.abrupt("return",n);case 12:return e.prev=12,e.t0=e.catch(1),console.error("Error fetching orders from DynamoDB:",e.t0),e.abrupt("return",this.getAllOrdersLocal());case 16:case"end":return e.stop()}},e,this,[[1,12]])})),function(e){return y.apply(this,arguments)})},{key:"getOrderByIdDynamoDB",value:(v=(0,n.A)(c().mark(function e(t,r){var n,a,o;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getConfig(),e.prev=1,e.next=4,r.send(new u.s$({TableName:n.tableName,Key:{id:t}}));case 4:if(!(a=e.sent).Item){e.next=9;break}return console.log("Order found in DynamoDB:",(o=f(f({},a.Item),{},{createdAt:new Date(a.Item.createdAt),pickedUpAt:a.Item.pickedUpAt?new Date(a.Item.pickedUpAt):void 0})).id,o.orderNumber),e.abrupt("return",o);case 9:return console.warn("Order not found in DynamoDB:",t),e.abrupt("return",null);case 13:return e.prev=13,e.t0=e.catch(1),console.error("Error fetching order from DynamoDB:",e.t0),e.abrupt("return",this.getOrderByIdLocal(t));case 17:case"end":return e.stop()}},e,this,[[1,13]])})),function(e,t){return v.apply(this,arguments)})},{key:"updateOrderDynamoDB",value:(k=(0,n.A)(c().mark(function e(t,r,n){var a,o,s,l;return c().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.getConfig(),e.prev=1,"picked_up"!==r.status||r.pickedUpAt||(r.pickedUpAt=new Date),o=Object.keys(r).filter(function(e){return"id"!==e&&"createdAt"!==e}).map(function(e){return"#".concat(e," = :").concat(e)}).join(", "),s=Object.keys(r).filter(function(e){return"id"!==e&&"createdAt"!==e}).reduce(function(e,t){return f(f({},e),{},(0,i.A)({},"#".concat(t),t))},{}),l=Object.keys(r).filter(function(e){return"id"!==e&&"createdAt"!==e}).reduce(function(e,t){var n=r[t];return f(f({},e),{},(0,i.A)({},":".concat(t),n instanceof Date?n.toISOString():n))},{}),e.next=8,n.send(new u.fR({TableName:a.tableName,Key:{id:t},UpdateExpression:"SET ".concat(o),ExpressionAttributeNames:s,ExpressionAttributeValues:l,ReturnValues:"ALL_NEW"}));case 8:return console.log("Order updated in DynamoDB:",t),this.updateOrderLocal(t,r),e.abrupt("return",this.getOrderByIdDynamoDB(t,n));case 13:return e.prev=13,e.t0=e.catch(1),console.error("Error updating order in DynamoDB:",e.t0),e.abrupt("return",this.updateOrderLocal(t,r));case 17:case"end":return e.stop()}},e,this,[[1,13]])})),function(e,t,r){return k.apply(this,arguments)})},{key:"testStorage",value:function(){var e=this.getStorage();if(!e.available)return{available:!1,type:"memory",error:"Neither localStorage nor sessionStorage available"};try{var t=this.getStorageKey()+"_test",r={id:"test_"+Date.now(),orderNumber:"TEST001",customerName:"Test Customer",customerEmail:"test@example.com",orderDetails:"Test order details",status:"pending",createdAt:new Date};e.setItem(t,JSON.stringify([r]));var n=e.getItem(t);if(n){var a=JSON.parse(n);if(1===a.length&&a[0].id===r.id)return e.setItem(t,""),{available:!0,type:"persistent"}}return{available:!1,type:"unknown",error:"Storage test failed"}}catch(e){return{available:!1,type:"error",error:e instanceof Error?e.message:"Unknown error"}}}},{key:"createOrderLocal",value:function(e){var t="id"in e&&"createdAt"in e?e:f(f({},e),{},{id:Date.now().toString()+"_"+Math.random().toString(36).substr(2,9),createdAt:new Date}),r=this.getStorage(),n=this.getAllOrdersLocal(),a=n.findIndex(function(e){return e.id===t.id});a>=0?n[a]=t:n.push(t);try{var o=n.map(function(e){var t;return f(f({},e),{},{createdAt:e.createdAt.toISOString(),pickedUpAt:null==(t=e.pickedUpAt)?void 0:t.toISOString()})});r.setItem(this.getStorageKey(),JSON.stringify(o)),console.log("Order saved to localStorage:",t.id)}catch(e){console.error("Error saving order to storage:",e)}return t}},{key:"getAllOrdersLocal",value:function(){var e=this.getStorage(),t=this.getStorageKey();try{var r=e.getItem(t);if(!r||"null"===r||"[]"===r)return console.log("No orders found in storage"),[];var n=JSON.parse(r);if(!Array.isArray(n))return console.warn("Invalid orders data in storage, resetting"),e.setItem(t,"[]"),[];var a=n.map(function(e){return f(f({},e),{},{createdAt:new Date(e.createdAt),pickedUpAt:e.pickedUpAt?new Date(e.pickedUpAt):void 0})});return console.log("Loaded ".concat(a.length," orders from storage")),a}catch(r){console.error("Error parsing orders from storage:",r);try{e.setItem(t,"[]")}catch(e){console.error("Failed to reset storage:",e)}return[]}}},{key:"getOrderByIdLocal",value:function(e){var t=this.getAllOrdersLocal(),r=t.find(function(t){return t.id===e});return r?console.log("Order found:",r.id,r.orderNumber):(console.warn("Order not found:",e),console.log("Available order IDs:",t.map(function(e){return e.id}))),r||null}},{key:"updateOrderLocal",value:function(e,t){var r=this.getStorage(),n=this.getAllOrdersLocal(),a=n.findIndex(function(t){return t.id===e});if(-1===a)return console.warn("Order not found for update:",e),null;"picked_up"!==t.status||t.pickedUpAt||(t.pickedUpAt=new Date),n[a]=f(f({},n[a]),t);try{r.setItem(this.getStorageKey(),JSON.stringify(n)),console.log("Order updated successfully:",e)}catch(e){console.error("Error updating order in storage:",e)}return n[a]}}])}();(0,i.A)(m,"client",null),(0,i.A)(m,"fallbackMode",!1)}}]);